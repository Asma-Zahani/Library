<div class="card ml-3">
    <p-confirmDialog></p-confirmDialog>
    <div class="flex justify-content-end flex-wrap">
        <p-button *ngIf="!isPurchasesOrBorrows" icon="pi pi-plus" label="Add" class="p-button p-component"
            (click)="Add()"></p-button>
    </div>

    <p-table [columns]="columns.slice(0, 6)" [value]="getActiveList()" [paginator]="true" [rows]="5"
        [rowsPerPageOptions]="[5, 10, 20]">
        <ng-template pTemplate="header" let-columns>
            <tr>
                <th *ngFor="let col of columns">{{ col | titlecase }}</th>
                <th *ngIf="!isPurchasesOrBorrows">Actions</th>
                <th *ngIf="apiPath === 'borrows'">Return</th>
            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-rowData let-columns="columns">
            <tr>
                <td *ngFor="let col of columns">
                    <ng-container [ngSwitch]="col">
                        <!-- Display specific fields for user and book -->
                        <span *ngSwitchCase="'user'">{{ rowData.user?.username || 'N/A' }}</span>
                        <span *ngSwitchCase="'book'">{{ rowData.book?.title || 'N/A' }}</span>

                        <!-- Handle array fields with ngIf -->
                        <ng-container *ngIf="isArray(rowData[col]); else notArray">
                            <ul>
                                <li *ngFor="let item of rowData[col]">
                                    {{ item.name }}
                                </li>
                            </ul>
                        </ng-container>
                        <ng-template #notArray>
                            <!-- Default fallback for other columns -->
                            <span *ngSwitchDefault>{{ rowData[col] || 'N/A' }}</span>
                        </ng-template>
                    </ng-container>
                </td>
                <td *ngIf="!isPurchasesOrBorrows">
                    <!-- Edit and Delete buttons -->
                    <p-button icon="pi pi-pencil" label="" class="p-button-rounded p-button-text"
                        (click)="editRow(rowData)"></p-button>

                    <p-button icon="pi pi-trash" label="" class="p-button-rounded p-button-danger p-button-text"
                        (click)="confirmDelete(rowData)"></p-button>
                </td>
                <td *ngIf="apiPath === 'borrows' && rowData.actualReturnDate === null">
                    <p-button icon="pi pi-refresh" label="" class="p-button-rounded p-button-danger p-button-text"
                        (click)="returnBook(rowData)"></p-button>
                </td>

            </tr>
        </ng-template>
    </p-table>
</div>